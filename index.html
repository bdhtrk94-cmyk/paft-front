<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAFT Global Presence - Interactive World Map</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">


    <style>
        @keyframes float {

            0%,
            100% {
                transform: translateY(0px) rotate(0deg);
            }

            50% {
                transform: translateY(-20px) rotate(180deg);
            }
        }

        .map-container {
            position: relative;
            width: 100%;
            height: 800px;
        }

        #map {
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* Floating Search */
        .floating-search {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
        }

        .search-box {
            position: relative;
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 12px 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-width: 300px;
        }

        .search-icon {
            color: #667eea;
            margin-right: 10px;
        }

        .search-box input {
            border: none;
            outline: none;
            background: transparent;
            flex: 1;
            font-size: 14px;
            color: #333;
        }

        .search-box input::placeholder {
            color: #999;
        }

        .search-clear {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .search-clear:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        /* Enhanced Floating Sidebar */
        .floating-sidebar {
            position: absolute;
            left: 30px;
            top: 30px;
            height: 700px;
            width: 350px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(25px);
            border-radius: 25px;
            z-index: 1000;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        .floating-sidebar.collapsed {
            width: 80px;
        }

        .floating-sidebar.collapsed .sidebar-content {
            opacity: 0;
            pointer-events: none;
        }

        .floating-sidebar.collapsed .brand-text {
            opacity: 0;
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.05));
        }

        .sidebar-brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .brand-icon {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .brand-title {
            font-size: 1.4rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
        }

        .brand-subtitle {
            font-size: 0.85rem;
            color: #666;
            font-weight: 500;
            margin-top: -2px;
        }

        .sidebar-toggle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(102, 126, 234, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #667eea;
        }

        .sidebar-toggle:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: scale(1.1);
        }

        .sidebar-content {
            padding: 25px;
            height: calc(100% - 95px);
            overflow-y: auto;
            transition: all 0.3s ease;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .stats-mini {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(102, 126, 234, 0.08);
            border-radius: 15px;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .stat-mini {
            flex: 1;
            text-align: center;
        }

        .stat-mini .stat-number {
            display: block;
            font-size: 1.8rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 2px;
        }

        .stat-mini .stat-label {
            font-size: 0.75rem;
            color: #666;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 25px;
            background: rgba(102, 126, 234, 0.08);
            border-radius: 15px;
            padding: 8px;
        }

        .filter-tab {
            flex: 1;
            padding: 12px 8px;
            border: none;
            background: transparent;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            color: #666;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .filter-tab:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .filter-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transform: translateY(-1px);
        }

        .country-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }

        .country-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .country-item:hover::before {
            transform: scaleY(1);
        }

        .country-item:hover {
            background: rgba(102, 126, 234, 0.05);
            transform: translateX(8px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .country-item.headquarters {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(192, 57, 43, 0.05));
            border-color: rgba(231, 76, 60, 0.2);
        }

        .country-item:last-child {
            margin-bottom: 40px;
        }

        .country-flag {
            width: 35px;
            height: 25px;
            border-radius: 6px;
            margin-right: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: white;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .country-info {
            flex: 1;
        }

        .country-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1rem;
            margin-bottom: 2px;
        }

        .country-type {
            font-size: 0.8rem;
            color: #666;
            opacity: 0.8;
        }

        .country-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #27ae60;
            margin-left: 10px;
            animation: pulse-dot 2s infinite;
        }

        @keyframes pulse-dot {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        /* Enhanced Map controls */
        .map-controls {
            position: absolute;
            top: 30px;
            right: 30px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.98);
            border: none;
            width: 55px;
            height: 55px;
            border-radius: 18px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #667eea;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .control-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea, #764ba2);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover::before {
            opacity: 1;
        }

        .control-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
            color: white;
        }

        .control-btn i {
            position: relative;
            z-index: 2;
        }

        /* Stats panel */
        .stats-panel {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            min-width: 200px;
        }

        .stats-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .stat-value {
            font-weight: bold;
            color: #e74c3c;
        }

        /* Custom marker styles */
        .paft-marker {
            background: #e74c3c;
            border: 3px solid white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            box-shadow: 0 2px 10px rgba(231, 76, 60, 0.5);
        }

        .paft-marker.headquarters {
            width: 30px;
            height: 30px;
            background: #c0392b;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(231, 76, 60, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(231, 76, 60, 0);
            }
        }

        /* Loading */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2000;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #e74c3c;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Enhanced Mobile responsive */
        @media (max-width: 1024px) {
            .header-stats {
                display: none;
            }

            .search-container {
                top: 90px;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                padding: 15px 20px;
            }

            .header-text h1 {
                font-size: 1.5rem;
            }

            .search-container {
                top: 80px;
                left: 20px;
                right: 20px;
                transform: none;
            }

            .search-box {
                min-width: auto;
            }

            .countries-sidebar {
                left: 10px;
                right: 10px;
                width: auto;
                top: auto;
                bottom: 10px;
                height: 250px;
                border-radius: 20px 20px 0 0;
            }

            .sidebar-content {
                height: calc(100% - 70px);
            }

            .map-controls {
                top: 140px;
                right: 20px;
                flex-direction: row;
                gap: 8px;
            }

            .control-btn {
                width: 45px;
                height: 45px;
                font-size: 16px;
            }

            .stats-panel {
                display: none;
            }
        }

        @media (max-width: 480px) {
            .header-content {
                padding: 12px 15px;
            }

            .logo-icon {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }

            .header-text h1 {
                font-size: 1.3rem;
            }

            .header-text p {
                font-size: 0.8rem;
            }

            .countries-sidebar {
                height: 200px;
            }

            .filter-tabs {
                gap: 3px;
            }

            .filter-tab {
                padding: 6px 8px;
                font-size: 0.8rem;
            }
        }

        /* Smooth scrollbar */
        .sidebar-content::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 3px;
        }

        .sidebar-content::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.3);
            border-radius: 3px;
        }

        .sidebar-content::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.5);
        }

        /* Loading enhancements */
        .loading {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .loading p {
            color: #667eea;
            font-weight: 500;
        }

        /* Enhanced Mobile Responsive */
        @media (max-width: 1024px) {
            .floating-sidebar {
                width: 320px;
            }
        }

        @media (max-width: 768px) {
            .floating-search {
                top: 20px;
                left: 20px;
                right: 20px;
                transform: none;
            }

            .search-box {
                min-width: auto;
            }

            .floating-sidebar {
                left: 15px;
                right: 15px;
                width: auto;
                top: auto;
                bottom: 15px;
                height: 280px;
                border-radius: 25px 25px 0 0;
            }

            .sidebar-content {
                height: calc(100% - 85px);
                padding: 20px;
            }

            .map-controls {
                top: 90px;
                right: 20px;
                flex-direction: row;
                gap: 10px;
            }

            .control-btn {
                width: 50px;
                height: 50px;
                font-size: 16px;
            }

            .stats-panel {
                display: none;
            }

            .stats-mini {
                margin-bottom: 20px;
            }
        }

        @media (max-width: 480px) {
            .floating-search {
                top: 15px;
                left: 15px;
                right: 15px;
            }

            .floating-sidebar {
                height: 250px;
                left: 10px;
                right: 10px;
                bottom: 10px;
            }

            .sidebar-header {
                padding: 20px;
            }

            .brand-icon {
                width: 40px;
                height: 40px;
                font-size: 1.1rem;
            }

            .brand-title {
                font-size: 1.2rem;
            }

            .filter-tabs {
                gap: 5px;
                margin-bottom: 20px;
            }

            .filter-tab {
                padding: 10px 6px;
                font-size: 0.75rem;
            }

            .filter-tab i {
                display: none;
            }

            .map-controls {
                top: 75px;
                right: 15px;
                gap: 8px;
            }

            .control-btn {
                width: 45px;
                height: 45px;
                font-size: 15px;
            }
        }
    </style>
</head>

<body data-rsssl=1 data-rsssl=1>
    <div class="map-container">
        <!-- Loading spinner -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Loading Global Map...</p>
        </div>

        <!-- Header -->


        <!-- Floating Search Bar -->
        <div class="floating-search">
            <div class="search-box">
                <i class="fas fa-search search-icon"></i>
                <input type="text" placeholder="Search countries..." id="searchInput">
                <button class="search-clear" id="searchClear" style="display: none;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- Enhanced Floating Sidebar -->
        <div class="floating-sidebar">
            <div class="sidebar-header">
                <div class="sidebar-brand">
                    <div class="brand-icon">
                        <i class="fas fa-globe-americas"></i>
                    </div>
                    <div class="brand-text">
                        <div class="brand-title">PAFT</div>
                        <div class="brand-subtitle">Global Network</div>
                    </div>
                </div>
                <div class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-chevron-left"></i>
                </div>
            </div>
            <div class="sidebar-content">
                <div class="stats-mini">
                    <div class="stat-mini">
                        <span class="stat-number" id="countryCount">13</span>
                        <span class="stat-label">Countries</span>
                    </div>
                    <div class="stat-mini">
                        <span class="stat-number">4</span>
                        <span class="stat-label">Regions</span>
                    </div>
                </div>
                <div class="filter-tabs">
                    <button class="filter-tab active" data-filter="all">
                        <i class="fas fa-globe"></i> All
                    </button>
                    <button class="filter-tab" data-filter="headquarters">
                        <i class="fas fa-star"></i> HQ
                    </button>
                    <button class="filter-tab" data-filter="office">
                        <i class="fas fa-building"></i> Offices
                    </button>
                </div>
                <div id="countriesList"></div>
            </div>
        </div>

        <!-- Map controls -->
        <div class="map-controls">
            <button class="control-btn" onclick="resetView()" title="Reset View">
                <i class="fas fa-home"></i>
            </button>
            <button class="control-btn" onclick="toggleFullscreen()" title="Fullscreen">
                <i class="fas fa-expand"></i>
            </button>
            <button class="control-btn" onclick="showAllMarkers()" title="Show All">
                <i class="fas fa-eye"></i>
            </button>
        </div>

        <!-- Stats panel -->
        <div class="stats-panel">
            <div class="stats-title">
                <i class="fas fa-chart-bar"></i> Global Stats
            </div>
            <div class="stat-item">
                <span>Countries:</span>
                <span class="stat-value" id="countryCount">0</span>
            </div>
            <div class="stat-item">
                <span>Regions:</span>
                <span class="stat-value">3</span>
            </div>
            <div class="stat-item">
                <span>Headquarters:</span>
                <span class="stat-value">Egypt</span>
            </div>
        </div>

        <!-- The map -->
        <div id="map"></div>
    </div>



    <!-- Leaflet JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>

    <script>
        let map;
        let markers = [];

        // PAFT countries data with coordinates
        const paftCountries = [
            // Headquarters
            { name: 'Egypt', coords: [26.8206, 30.8025], type: 'headquarters', region: 'Middle East & Africa' },

            // Middle East & Africa
            { name: 'Morocco', coords: [31.7917, -7.0926], type: 'office', region: 'Middle East & Africa' },
            { name: 'Sudan', coords: [12.8628, 30.2176], type: 'office', region: 'Middle East & Africa' },
            { name: 'Syria', coords: [34.8021, 38.9968], type: 'office', region: 'Middle East & Africa' },
            { name: 'Kenya', coords: [-0.0236, 37.9062], type: 'office', region: 'Middle East & Africa' },
            { name: 'Saudi Arabia', coords: [23.8859, 45.0792], type: 'office', region: 'Middle East & Africa' },
            { name: 'Libya', coords: [26.3351, 17.2283], type: 'office', region: 'Middle East & Africa' },
            { name: 'Jordan', coords: [30.5852, 36.2384], type: 'office', region: 'Middle East & Africa' },
            { name: 'Algeria', coords: [28.0339, 1.6596], type: 'office', region: 'Middle East & Africa' },
            { name: 'UAE', coords: [23.4241, 53.8478], type: 'office', region: 'Middle East & Africa' },
            { name: 'Lebanon', coords: [33.8547, 35.8623], type: 'office', region: 'Middle East & Africa' },
            { name: 'Ghana', coords: [7.9465, -1.0232], type: 'office', region: 'Middle East & Africa' },
            { name: 'Nigeria', coords: [9.0820, 8.6753], type: 'office', region: 'Middle East & Africa' }
        ];

        // Initialize map
        function initMap() {
            try {
                console.log('Initializing global map...');

                // Create map with world view
                map = L.map('map', {
                    zoomControl: false,
                    worldCopyJump: true
                }).setView([20, 20], 2);

                // Add tile layer
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: 'Â© OpenStreetMap contributors',
                    maxZoom: 18,
                    minZoom: 2
                }).addTo(map);

                // Add zoom control
                L.control.zoom({
                    position: 'bottomleft'
                }).addTo(map);

                // Add markers for each country
                addCountryMarkers();

                // Populate countries list
                populateCountriesList();

                // Update stats
                document.getElementById('countryCount').textContent = paftCountries.length;

                // Hide loading
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                    console.log('Global map loaded successfully!');
                }, 1000);

            } catch (error) {
                console.error('Error initializing map:', error);
                document.getElementById('loading').innerHTML = `
                        <div style="color: #e74c3c; text-align: center;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 10px;"></i><br>
                            <strong>Map Loading Failed</strong><br>
                            <small>Please check your internet connection</small><br>
                            <button onclick="location.reload()" style="margin-top: 15px; padding: 10px 20px; background: #e74c3c; color: white; border: none; border-radius: 8px; cursor: pointer;">
                                <i class="fas fa-refresh"></i> Retry
                            </button>
                        </div>
                    `;
            }
        }

        // Add markers for all countries
        function addCountryMarkers() {
            paftCountries.forEach(country => {
                const isHQ = country.type === 'headquarters';

                // Create custom marker
                const markerIcon = L.divIcon({
                    html: `<div class="paft-marker ${isHQ ? 'headquarters' : ''}"></div>`,
                    className: 'custom-marker',
                    iconSize: [20, 20],
                    iconAnchor: [10, 10]
                });

                // Create marker
                const marker = L.marker(country.coords, { icon: markerIcon }).addTo(map);

                // Create popup content
                const popupContent = `
                        <div style="text-align: center; min-width: 150px;">
                            <h4 style="margin: 0 0 8px 0; color: #2c3e50;">
                                ${isHQ ? '<i class="fas fa-star"></i>' : '<i class="fas fa-building"></i>'} 
                                ${country.name}
                            </h4>
                            <p style="margin: 0 0 8px 0; color: #666; font-size: 0.9rem;">
                                ${isHQ ? 'Headquarters' : 'Regional Office'}
                            </p>
                            <p style="margin: 0 0 10px 0; color: #888; font-size: 0.8rem;">
                                ${country.region}
                            </p>
                            <button onclick="focusCountry('${country.name}')" 
                                    style="background: #e74c3c; color: white; border: none; padding: 6px 12px; border-radius: 15px; cursor: pointer; font-size: 0.8rem;">
                                <i class="fas fa-search-plus"></i> Focus
                            </button>
                        </div>
                    `;

                marker.bindPopup(popupContent);

                // Store marker reference
                markers.push({ marker, country });
            });
        }

        // Enhanced populate countries sidebar
        function populateCountriesList() {
            const countriesList = document.getElementById('countriesList');

            paftCountries.forEach(country => {
                const countryItem = document.createElement('div');
                countryItem.className = `country-item ${country.type}`;
                countryItem.setAttribute('data-type', country.type);
                countryItem.setAttribute('data-name', country.name.toLowerCase());
                countryItem.onclick = () => focusCountry(country.name);

                countryItem.innerHTML = `
                    <div class="country-flag">${country.name.substring(0, 2).toUpperCase()}</div>
                    <div class="country-info">
                        <div class="country-name">
                            ${country.name}
                            ${country.type === 'headquarters' ? '<i class="fas fa-star" style="color: #f39c12; margin-left: 5px;"></i>' : ''}
                        </div>
                        <div class="country-type">${country.type === 'headquarters' ? 'Headquarters' : 'Regional Office'}</div>
                    </div>
                    <div class="country-status"></div>
                `;

                countriesList.appendChild(countryItem);
            });

            // Add filter functionality
            setupFilters();
            setupSearch();
            setupSidebarToggle();
        }

        // Setup filter tabs
        function setupFilters() {
            const filterTabs = document.querySelectorAll('.filter-tab');
            const countryItems = document.querySelectorAll('.country-item');

            filterTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Update active tab
                    filterTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    const filter = tab.getAttribute('data-filter');

                    // Filter countries
                    countryItems.forEach(item => {
                        if (filter === 'all' || item.getAttribute('data-type') === filter) {
                            item.style.display = 'flex';
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            });
        }

        // Setup search functionality
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchClear = document.getElementById('searchClear');
            const countryItems = document.querySelectorAll('.country-item');

            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();

                if (query) {
                    searchClear.style.display = 'block';
                } else {
                    searchClear.style.display = 'none';
                }

                countryItems.forEach(item => {
                    const countryName = item.getAttribute('data-name');
                    if (countryName.includes(query)) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });

            searchClear.addEventListener('click', () => {
                searchInput.value = '';
                searchClear.style.display = 'none';
                countryItems.forEach(item => {
                    item.style.display = 'flex';
                });
            });
        }

        // Setup sidebar toggle
        function setupSidebarToggle() {
            const sidebar = document.querySelector('.countries-sidebar');
            const toggle = document.getElementById('sidebarToggle');
            const toggleIcon = toggle.querySelector('i');

            toggle.addEventListener('click', () => {
                sidebar.classList.toggle('collapsed');

                if (sidebar.classList.contains('collapsed')) {
                    toggleIcon.className = 'fas fa-chevron-right';
                } else {
                    toggleIcon.className = 'fas fa-chevron-left';
                }
            });
        }

        // Focus on specific country
        function focusCountry(countryName) {
            const countryData = paftCountries.find(c => c.name === countryName);
            if (countryData && map) {
                // Always center the country in the middle of the screen with good zoom level
                map.flyTo(countryData.coords, 8, {
                    animate: true,
                    duration: 1.5
                });

                // Find and open popup for this country after animation
                setTimeout(() => {
                    const markerData = markers.find(m => m.country.name === countryName);
                    if (markerData) {
                        markerData.marker.openPopup();
                    }
                }, 800);
            }
        }

        // Reset to world view
        function resetView() {
            if (map) {
                map.setView([20, 20], 2);
            }
        }

        // Show all markers in view
        function showAllMarkers() {
            if (map && markers.length > 0) {
                const group = new L.featureGroup(markers.map(m => m.marker));
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }

        // Toggle fullscreen
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function () {
            console.log('DOM loaded, initializing global map...');
            setTimeout(initMap, 500);
        });

        // Add some interactivity
        document.addEventListener('keydown', function (e) {
            // Press 'R' to reset view
            if (e.key === 'r' || e.key === 'R') {
                resetView();
            }
            // Press 'A' to show all markers
            if (e.key === 'a' || e.key === 'A') {
                showAllMarkers();
            }
        });
    </script>
</body>

</html>